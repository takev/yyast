<?xml version="1.0" encoding="utf-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>YYAST</title>
<link rel="stylesheet" type="text/css" href="style/base.css"/>
</head>
<body>
<h1>YYAST - Documentation</h1>
<p class="author">by Take Vos (2013)</p>
<p>YYAST is a library which completes lex and yacc by adding an abstract syntax tree (AST) generator.
The saved AST is designed to be easily parsed by compilers.
</p>

<h2>Reason for change</h2>
<p>In the first version of yyast the file format was not formalized and it was more to see if the
design would work. During the work on tumomo it has proved itself. However I missed the line control
mechanism available in C/C++ for tracking line in sources of generated code.
</p>
<p>Adding the filename to each node would needlessly increase the footprint of the resulting file.
Therefor a list of filenames is added to the file header and each node has an index into this list.
</p>
<p>Line numbers and column numbers are 32 bit, which is also the maximum size in LLVM. Line numbers
and columns start at 1. 0 is used to denote an unknown line or column.
</p>
<p>The original file format used FourCC for the name of each node, EightCC will give a little bit more
room without complicating the format with variable sized strings.
</p>
<p>The file format is carefully aligned so that when the file is mapped into memory it can be directly
accessed with unaligned reads without causing bus faults on some CPU architectures.
</p>

<h2>File format</h2>
<p>The file starts with a special node called 'yyast 13'. It has two child nodes, the
first is the special '@header' node, the second node is the top level node of the
parsed file.
</p>

<h3>File Header</h3>
<table>
<tr><th>name</th><th>parent</th><th>description</th></tr>
<tr><td>yyast 13</td><td></td><td>File level node.</td></tr>
<tr><td>@header</td><td>yyast 13</td><td>Header node.</td></tr>
<tr><td>@files</td><td>@header</td><td>A list of source files. Those files names in line control commands.</td></tr>
<tr><td>@file</td><td>@files</td><td>A text leaf node, containing the filename of a source file.</td></tr>
</table>

<h3>Node Header</h3>
<p>All Nodes are aligned to 64 bit boundary. All fields in the header are packed. All integer
fields are in big endian.
</p>

<table>
<tr><th>type</th>     <th>description</th></tr>
<tr><td>EightCC</td>  <td>Name of this node.</td></tr>
<tr><td>uint64_t</td> <td>Data size.</td></tr>
<tr><td>uint32_t</td> <td>Line number. The top most line is 1.</td></tr>
<tr><td>uint32_t</td> <td>Column number. The left most column is zero</td></tr>
<tr><td>uint32_t</td> <td>File number. The first file (the main file) is zero.</td></tr>
<tr><td>uint16_t</td> <td>Reserved, must be zero.</td></tr>
<tr><td>uint8_t</td>  <td>Reserved, must be zero.</td></tr>
<tr><td>uint8_t</td>  <td>Node type.</td></tr>
<tr><td></td>         <td>Data. 64 bit aligned</td></tr>
</table>

<h3>Node Types</h3>

<table>
<tr><th>Name</th><th>Value</th><th>Description</th></tr>
<tr><td>NODE_TYPE_PASS</td><td>0</td><td>A unused positional parameter, as a child node.</td></tr>
<tr><td>NODE_TYPE_EMPTY</td><td>0</td><td>A node without data or children.</td></tr>
<tr><td>NODE_TYPE_BRANCH</td><td>0</td><td>A node with children.</td></tr>
<tr><td>NODE_TYPE_TEXT</td><td>0</td><td>A node with a null terminated UTF-8 text string, with null padding for 64 bit alignment.</td></tr>
<tr><td>NODE_TYPE_POSITIVE_INTEGER</td><td></td><td>An unsigned integer in big endian format. The size of the integer is a multiple of 8 butes.</td></tr>
<tr><td>NODE_TYPE_NEGATIVE_INTEGER</td><td></td><td>An unsigned integer in big endian format. The size of the integer is a multiple of 8 butes. The integer has an implicit negative sign.</td></tr>
<tr><td>NODE_TYPE_BINARY_FLOAT</td><td></td><td>A 'big-endian' IEEE 754 floating point number in "binary 64" or "binary 128" format.</td></tr>
<tr><td>NODE_TYPE_DECIMAL_FLOAT</td><td></td><td>A 'big-endian' IEEE 754 floating point number in "decimal 64" or "decimal 128" format.</td></tr>
</table>

<h2>API</h2>

<h3>Node</h3>

<h3>List of Nodes</h3>

</body>
</html>
